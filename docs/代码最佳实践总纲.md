### **代码最佳实践总纲**

#### **一、 结构与设计原则 (Architecture & Design)**

1.  **高内聚 (High Cohesion)**
    *   **核心思想**：将关联性强、功能相近的代码组织在一起。一个模块（或类、方法）只做一件事，并且把它做好。
    *   **实践**：
        *   **单一职责原则 (SRP)**：一个类应该只有一个引起它变化的原因。
        *   **功能集中**

2.  **低耦合 (Low Coupling)**
    *   **核心思想**：模块之间应减少相互依赖，特别是对内部实现细节的依赖。让模块可以独立地被开发、测试和替换。
    *   **实践**：
        *   **面向接口编程**：依赖抽象（接口或抽象类）而不是具体实现。
        *   **依赖注入 (DI)**：不要在类内部 `new` 它的依赖，而是通过构造函数或方法将依赖传递进来。
        *   **事件/消息驱动**：对于非核心依赖，可以使用事件或消息来解耦。

3.  **模块化 (Modularity)**
    *   **核心思想**：将大型系统拆分为小的、独立的、可复用的模块。
    *   **实践**：可以明确划分出 **UI层** (Ribbon按钮、预览窗格)、**逻辑层** (转换引擎、缓存管理) 和 **数据/API交互层** (OneNote XML读写)。

#### **二、 性能与响应性 (Performance & Responsiveness)**

1.  **UI 非阻塞 (Non-blocking UI)**
    *   **核心思想**：任何耗时操作（>50ms）都不能在UI线程上执行，否则会导致界面卡顿或“未响应”。
    *   **实践**：
        *   **异步编程 (`async/await`)**
        *   **任务并行库 (TPL)**：使用 `Task.Run()` 可以轻松地将同步代码块抛到后台线程执行。

2.  **高效的算法与数据结构**
    *   **核心思想**：为特定任务选择最合适的数据结构和算法。

3.  **资源管理 (Resource Management)**
    *   **核心思想**：及时释放不再使用的资源，如文件句柄、网络连接、图形对象等。
    *   **实践**：在 C# 中，正确使用 `using` 语句来处理实现了 `IDisposable` 接口的对象，确保其 `Dispose` 方法被调用。

#### **三、 可读性与可维护性 (Readability & Maintainability)**

1.  **清晰命名 (Clear Naming)**
    *   **核心思想**：变量、方法、类的名字应该准确地反映其用途。

2.  **函数/方法短小精悍**
    *   **核心思想**：一个函数只做一件事。理想情况下，一个函数不应超过一屏（约20-30行）。
    *   **实践**：如果一个函数内部有明显的逻辑步骤，应将每个步骤提取成独立的私有方法。这使得主函数读起来像一个大纲。

3.  **注释的艺术 (Meaningful Comments)**
    *   **核心思想**：代码本身应该能清晰地说明它在做什么。**不要**在注释里写修改历史等修改性注释，可以适量记录解释性/意图性注释。

4.  **保持简单 (KISS - Keep It Simple, Stupid)**
    *   **核心思想**：用最直接、最简单的方式解决问题，避免过度设计和炫技。简单的代码更容易理解、测试和维护。

#### **四、 健壮性 (Robustness)**

1.  **错误处理 (Error Handling)**
    *   **核心思想**：预见可能出错的地方，并准备好处理策略。
    *   **实践**：
        *   使用 `try-catch` 块捕获特定类型的异常。不要用一个空的 `catch` 块吞掉所有异常。
        *   向上层调用者或用户提供有意义的错误信息。
        *   对于可以预见的失败情况（如文件不存在），优先使用 `if` 判断，而不是依赖异常处理。

2.  **输入验证 (Input Validation)**
    *   **核心思想**：永远不要相信外部输入，包括来自用户、API 或文件的数据。
    *   **实践**：在使用任何输入数据前，检查其是否为 `null`、是否为空、格式是否正确。